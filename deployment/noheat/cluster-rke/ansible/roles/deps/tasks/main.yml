- name: Download cert-manager
  get_url:
    url: "https://github.com/jetstack/cert-manager/releases/download/v{{ cert_manager_version }}/cert-manager.yaml"
    dest: "/tmp"
    mode: '0400'

- name: Deploy cert-manager
  kubernetes.core.k8s:
    src: /tmp/cert-manager.yaml
    state: present

- name: Add prometheus Helm repository
  kubernetes.core.helm_repository:
    name: prometheus
    repo_url: https://prometheus-community.github.io/helm-charts

- name: Deploy Prometheus charts
  kubernetes.core.helm:
    name: prometheus
    chart_version: "{{ prometheus_version }}"
    chart_ref: prometheus/kube-prometheus-stack
    release_namespace: prometheus
    create_namespace: true
